<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</title>
  <style>
    body {
      font-family: monospace;
      background-color: #fff;
      color: #000;
      padding: 1em;
      max-width: 600px;
      margin: 0 auto;
    }
    #date { 
      font-weight: bold; 
      margin-bottom: 1em; 
      font-size: 1.2em;
    }
    #content { 
      white-space: pre-wrap; 
      line-height: 1.6;
      margin-bottom: 2em;
    }
    #passwordPrompt {
      display: none;
      margin-top: 1em;
      padding: 1em;
      border: 1px solid #000;
      background-color: #f9f9f9;
    }
    #randomButton {
      display: block;
      margin: 2em auto;
      padding: 1em 2em;
      font-size: 1.1em;
      cursor: pointer;
    }
    #randomButton:disabled {
      background-color: #ccc;
      color: #666;
      cursor: not-allowed;
    }
    #quota {
      text-align: center;
      margin-bottom: 1em;
      font-size: 0.9em;
      color: #666;
    }
    input, button {
      font-family: monospace;
      background: #fff;
      color: #000;
      border: 1px solid #000;
      padding: 0.5em;
      margin: 0.25em;
    }
    button:hover:not(:disabled) {
      background-color: #000;
      color: #fff;
    }
    .entry-container {
      display: none;
      margin-top: 2em;
    }
    .entry-container.show {
      display: block;
    }
    .loading {
      text-align: center;
      color: #666;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>üìì ‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h1>
  
  <div id="quota"></div>
  
  <button id="randomButton" onclick="randomDiary()">
    üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà
  </button>
  
  <div id="diary" class="entry-container">
    <div id="date"></div>
    <div id="content"></div>
    <div id="passwordPrompt">
      <p>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ üîí ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</p>
      <input type="password" id="pw" placeholder="password">
      <button onclick="checkPassword()">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å</button>
    </div>
  </div>

  <script>
    let diaryData = [];
    let currentEntry = null;
    let hasReadToday = false;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    function checkDailyQuota() {
      const today = new Date().toISOString().slice(0, 10);
      const lastReadDate = getStoredData('lastReadDate');
      
      if (lastReadDate === today) {
        hasReadToday = true;
        document.getElementById('randomButton').disabled = true;
        document.getElementById('randomButton').textContent = 'üìö ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
        document.getElementById('quota').textContent = '‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏∞';
      } else {
        hasReadToday = false;
        document.getElementById('randomButton').disabled = false;
        document.getElementById('randomButton').textContent = 'üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà';
        document.getElementById('quota').textContent = 'üìñ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô';
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô memory (‡πÅ‡∏ó‡∏ô localStorage)
    const memoryStorage = {};
    
    function getStoredData(key) {
      return memoryStorage[key] || null;
    }
    
    function setStoredData(key, value) {
      memoryStorage[key] = value;
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà
    async function loadDiary() {
      try {
        const res = await fetch("diary.json");
        if (!res.ok) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå diary.json");
        diaryData = await res.json();
        console.log("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", diaryData.length, "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
      } catch (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        diaryData = [
          {
            date: "2025-07-15",
            content: "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏Ñ‡πà‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n‡πÑ‡∏´‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î",
            locked: false
          },
          {
            date: "2025-08-01",
            content: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î üéÇ",
            locked: true,
            password: "hello123"
          },
          {
            date: "2025-12-31",
            content: "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ",
            locked: false,
            forceDate: "2025-12-31"
          }
        ];
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå diary.json ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á");
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà
    async function randomDiary() {
      if (hasReadToday) {
        alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏∞");
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
      document.getElementById('content').innerHTML = '<div class="loading">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà...</div>';
      document.getElementById('diary').className = 'entry-container show';

      // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
      await new Promise(resolve => setTimeout(resolve, 1000));

      const today = new Date().toISOString().slice(0, 10);
      let entry = null;

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      const forcedEntry = diaryData.find(d => d.forceDate === today);
      if (forcedEntry) {
        entry = forcedEntry;
        console.log("‡∏û‡∏ö‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ");
      } else {
        // ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        const availableEntries = diaryData.filter(d => !d.forceDate);
        if (availableEntries.length === 0) {
          alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô");
          return;
        }
        entry = availableEntries[Math.floor(Math.random() * availableEntries.length)];
        console.log("‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡πÑ‡∏î‡πâ:", entry.date);
      }

      currentEntry = entry;
      document.getElementById('date').textContent = `üìÖ ${entry.date}`;
      document.getElementById('content').innerHTML = '';

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (entry.locked) {
        document.getElementById('passwordPrompt').style.display = 'block';
      } else {
        document.getElementById('passwordPrompt').style.display = 'none';
        revealLines(entry.content);
      }

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
      setStoredData('lastReadDate', today);
      hasReadToday = true;
      document.getElementById('randomButton').disabled = true;
      document.getElementById('randomButton').textContent = 'üìö ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
      document.getElementById('quota').textContent = '‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏∞';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
    function checkPassword() {
      const pw = document.getElementById('pw').value;
      if (pw === currentEntry.password) {
        document.getElementById('passwordPrompt').style.display = 'none';
        document.getElementById('pw').value = '';
        revealLines(currentEntry.content);
      } else {
        alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        document.getElementById('pw').value = '';
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
    function revealLines(text) {
      const lines = text.split('\n');
      document.getElementById('content').innerHTML = '';
      
      let i = 0;
      const interval = setInterval(() => {
        if (i >= lines.length) {
          clearInterval(interval);
          return;
        }
        
        const line = document.createElement('div');
        line.textContent = lines[i];
        document.getElementById('content').appendChild(line);
        i++;
      }, 1000);
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏î Enter ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('pw').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkPassword();
        }
      });
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
    async function init() {
      await loadDiary();
      checkDailyQuota();
    }

    init();
  </script>
</body>
</html>
